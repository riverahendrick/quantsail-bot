# Changelog — Quantsail

## Unreleased
- 2026-01-28: **Gap Remediation & Full System Audit**: Conducted forensic audit and closed all critical gaps.
  - **API**: Added missing `v1/config` (versioning), `v1/exchanges` (encrypted keys), and `v1/bot` control endpoints. Implemented `EncryptionService` (AES-GCM).
  - **Engine**: Implemented `LiveExecutor.check_exits` (real market sell logic) and updated repository to persist risk parameters (`stop_price`, `take_profit_price`).
  - **Dashboard**: Created missing pages: Strategy (JSON Editor), Risk (Controls), Exchange (Key Management), and Events (Log). Created shared UI components (`Table`, `Input`, `Label`, `Textarea`) and API client. Full i18n support for new pages.
- 2026-01-27: **ARM LIVE & Live Execution**: Implemented critical safety gates for live trading. Added `POST /v1/bot/arm` (2-step verification) and `POST /v1/bot/start` requiring a short-lived token. Implemented `LiveExecutor` with `BinanceSpotAdapter` (via `ccxt`) ensuring strict idempotency using deterministic `client_order_id`. Added restart reconciliation logic to `TradingLoop` to detect orphaned orders. Dashboard updated with an "ARM LIVE" modal flow. Verified with unit, integration, and E2E tests.
- 2026-01-27: **Public Transparency Dashboard**: Implemented public-facing pages at `/public/*` ensuring full transparency without exposing private data. Features a sanitized Overview with equity curve and KPIs, a real-time (delayed) Trades Feed, and a detailed Transparency Report explaining the bot's safety mechanisms. Built with strict data sanitization logic (no internal IDs/secrets) and validated via E2E tests. Includes responsive mobile-first navigation and i18n support.
- 2026-01-27: **Private Dashboard Overview**: Implemented the operator dashboard at `/app/overview` featuring real-time status banner, KPI grid, Daily Target Lock visualizer, Active Breakers list, and Recent Trades table. Built with modern UI components (Tailwind + Lucide icons), a "trading terminal" dark theme, and an App Shell with sidebar navigation. Includes an `EquityChart` visualization using Recharts. Wired to the backend via WebSocket using `zustand` for state management. Includes `AuthGuard` for route protection (with dev bypass) and full i18n support (EN/ES). Validated with E2E tests using Playwright.
- 2026-01-27: **Daily Target Lock**: Implemented daily profit target enforcement with two modes: STOP (hard stop at target) and OVERDRIVE (trailing profit floor). Added `DailyLockManager`, timezone-aware PnL tracking in `EngineRepository`, and integration into the entry pipeline. Features state persistence via peak PnL reconstruction from trade history. Emits `daily_lock.engaged`, `daily_lock.floor_updated`, and `daily_lock.entries_paused` events. Fully tested with 100% coverage.
- 2026-01-27: **News Pause Integration**: Implemented negative news pause feature with API ingestion endpoint (`POST /v1/news/ingest`), Redis/in-memory cache, and engine integration. Only negative + high-impact news triggers pause. Added endpoints for status check and manual clearing. Integrated with `BreakerManager` to block entries when news pause active (configurable via `config.breakers.news.enabled`). Emits `gate.news.rejected` event. Full test coverage for news cache, endpoints, and engine integration. Exits never blocked.
- 2026-01-27: **Circuit Breakers**: Implemented four circuit breaker types (volatility spike, spread/slippage spike, consecutive losses, exchange instability) that pause entries while allowing exits. Added `BreakerManager` with configurable expiry times, trigger logic with real-time market data checks (ATR multiple, spread_bps, consecutive loss tracking), and event emission (`breaker.triggered`, `breaker.expired`, `gate.breaker.rejected`). Integrated breakers into trading loop EVAL state with proper type checking and 100% test coverage for breaker modules.
- 2026-01-27: **Profitability Gate**: Implemented fee, slippage, and spread estimators using real-time orderbook depth. Updated `ProfitabilityGate` to reject trades below `min_profit_usd` after all estimated costs. Integrated estimators into the `TradingLoop` entry pipeline and added detailed `gate.profitability.passed/rejected` events with full cost breakdowns.
- 2026-01-27: **Strategies & Ensemble**: Implemented Trend (EMA/ADX), Mean Reversion (Bollinger/RSI), and Breakout (Donchian/ATR) strategies. Added pure-Python technical indicators and an EnsembleCombiner that aggregates strategy votes with configurable confidence thresholds. Updated engine loop to emit detailed `signal.generated` and `ensemble.decision` events.
- 2026-01-27: **Engine Dry-Run Core Loop**: Implemented complete trading engine with state machine (IDLE→EVAL→ENTRY_PENDING→IN_POSITION→EXIT_PENDING), deterministic dry-run execution, profitability gate, per-symbol orchestration, equity tracking, and full event emission. Added stub database models for testing, 145 tests passing with 98% coverage. Entry point ready for signal integration.
- 2026-01-27: Added event streaming support with an append-only events repository, WS cursor resume, heartbeat messages, and payload redaction.
- 2026-01-27: Expanded WS coverage for auth/cursor/heartbeat paths and ensured event tests respect trade foreign keys.
- 2026-01-27: Added Firebase JWT auth + RBAC enforcement for private API routes, plus sanitized public endpoints with rate limiting and full test coverage.
- 2026-01-27: Implemented SQLAlchemy models + Alembic migrations for the documented Postgres schema, added DB health endpoint and schema verification tests.
- 2026-01-27: Suppressed root layout hydration mismatches caused by external attributes in the dashboard.
- 2026-01-27: Added dashboard i18n (EN/ES), public overview page, Playwright baseline E2E, and a hardcoded-string guard; configured ruff/mypy/pytest coverage in API and Engine.
- 2026-01-27: Scaffolded dashboard (Next.js), API (FastAPI + uv), and engine (uv package), added local Docker Compose for Postgres/Redis, and introduced basic infra scripts and tests.
- 2026-01-26: Created documentation pack v7. Major expansion of PRD (detailed epics, acceptance criteria, checklists) and prompt pack (small scope prompts with high detail).

- 2026-01-26: Merged v4 missing docs (security ops, validation, glossary), expanded DB schema explicit columns, merged folder structure and overview, added prompt index/mapping, added candidate event.

- 2026-01-26: Preserved v4 prompt files under docs/08_PROMPTS/ and added compatibility redirect stubs at original v4 paths.
